{% comment %}
  T-Shirt Modal Snippet
  =====================
  FAZ 2: 4-Step Wizard + 3D Preview Modal
  
  Usage: {% render 'tshirt-modal' %}
  
  Features:
  - Step 1: Upload (inherited or new design)
  - Step 2: 3D Preview + Options (color, size, locations)
  - Step 3: Extra Questions
  - Step 4: Review & Actions
  
  Integration:
  - Listens for 'ul:openTShirtModal' event from DTF uploader
  - Uses Three.js for 3D rendering
  - Supports multi-location printing
  
  Version: 4.0.0
  Architecture: DTF_TSHIRT_MODAL_ARCHITECTURE.md
{% endcomment %}

<!-- Load Separate CSS -->
{{ 'tshirt-modal.css' | asset_url | stylesheet_tag }}

<!-- Modal HTML -->
<div class="ul-tshirt-overlay" id="ul-tshirt-overlay">
  <div class="ul-tshirt-modal">
    
    <!-- Header -->
    <div class="ul-tshirt-header">
      <span class="ul-tshirt-title">üëï T-Shirt Designer</span>
      <button type="button" class="ul-tshirt-close" id="ul-tshirt-close" aria-label="Close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    
    <!-- Step Progress -->
    <div class="ul-tshirt-steps">
      <div class="ul-step-item active" data-step="1">
        <div class="ul-step-number">1</div>
        <span class="ul-step-label">Upload</span>
      </div>
      <div class="ul-step-connector"></div>
      <div class="ul-step-item" data-step="2">
        <div class="ul-step-number">2</div>
        <span class="ul-step-label">Design</span>
      </div>
      <div class="ul-step-connector"></div>
      <div class="ul-step-item" data-step="3">
        <div class="ul-step-number">3</div>
        <span class="ul-step-label">Details</span>
      </div>
      <div class="ul-step-connector"></div>
      <div class="ul-step-item" data-step="4">
        <div class="ul-step-number">4</div>
        <span class="ul-step-label">Review</span>
      </div>
    </div>
    
    <!-- Body -->
    <div class="ul-tshirt-body">
      <div class="ul-tshirt-content">
        
        <!-- STEP 1: Upload -->
        <div class="ul-step-panel active" id="ul-step-1">
          <div class="ul-step1-content">
            
            <!-- Inherited Design (shown if coming from DTF) -->
            <div id="ul-inherited-section" style="display: none;">
              <div class="ul-step1-section-title">Use Your Existing Design</div>
              <div class="ul-step1-section-desc">Your uploaded design is ready to use on a t-shirt.</div>
              
              <div class="ul-inherited-design" id="ul-inherited-design">
                <div class="ul-inherited-preview">
                  <img src="" alt="Design preview" class="ul-inherited-thumb" id="ul-inherited-thumb">
                  <div class="ul-inherited-info">
                    <div class="ul-inherited-name" id="ul-inherited-name">design.png</div>
                    <div class="ul-inherited-meta" id="ul-inherited-meta">2400 x 3200 px ‚Ä¢ 300 DPI</div>
                    <div class="ul-inherited-badge">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 6L9 17l-5-5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      Already uploaded
                    </div>
                  </div>
                </div>
                <button type="button" class="ul-use-design-btn" id="ul-use-inherited-btn">
                  ‚úì Use This Design
                </button>
              </div>
              
              <div class="ul-divider"><span>OR</span></div>
            </div>
            
            <!-- Upload New Design -->
            <div id="ul-upload-section">
              <div class="ul-step1-section-title">Upload New Design</div>
              <div class="ul-step1-section-desc">Drag and drop or click to browse your files.</div>
              
              <div class="ul-upload-zone" id="ul-tshirt-upload-zone">
                <input type="file" id="ul-tshirt-file-input" accept=".png,.jpg,.jpeg,.svg,.webp" hidden>
                <div class="ul-upload-zone-icon">‚òÅÔ∏è</div>
                <div class="ul-upload-zone-text">Drag & Drop your design here</div>
                <div class="ul-upload-zone-hint">PNG, JPG, SVG, WEBP ‚Ä¢ Max 50MB</div>
                
                <div class="ul-upload-progress" id="ul-tshirt-upload-progress" style="display: none;">
                  <div class="ul-upload-progress-bar">
                    <div class="ul-upload-progress-fill" id="ul-tshirt-progress-fill"></div>
                  </div>
                  <div class="ul-upload-progress-text" id="ul-tshirt-progress-text">Uploading...</div>
                </div>
              </div>
              
              <!-- New upload preview (shown after upload) -->
              <div id="ul-new-upload-preview" style="display: none; margin-top: 16px;">
                <div class="ul-inherited-design selected">
                  <div class="ul-inherited-preview">
                    <img src="" alt="Uploaded design" class="ul-inherited-thumb" id="ul-new-upload-thumb">
                    <div class="ul-inherited-info">
                      <div class="ul-inherited-name" id="ul-new-upload-name">design.png</div>
                      <div class="ul-inherited-meta" id="ul-new-upload-meta">Uploaded successfully</div>
                      <div class="ul-inherited-badge">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M20 6L9 17l-5-5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Ready to use
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
          </div>
        </div>
        
        <!-- STEP 2: Design (3D + Options) -->
        <div class="ul-step-panel" id="ul-step-2">
          <div class="ul-step2-layout">
            
            <!-- 3D Preview -->
            <div class="ul-step2-3d">
              <div class="ul-3d-loading" id="ul-3d-loading">
                <div class="ul-3d-spinner"></div>
                <div>Loading 3D Preview...</div>
              </div>
              <canvas class="ul-3d-canvas" id="ul-3d-canvas"></canvas>
              
              <!-- Quick View Buttons -->
              <div class="ul-quick-views">
                <button type="button" class="ul-quick-view-btn active" data-view="front">Front</button>
                <button type="button" class="ul-quick-view-btn" data-view="back">Back</button>
                <button type="button" class="ul-quick-view-btn" data-view="left">Left</button>
                <button type="button" class="ul-quick-view-btn" data-view="right">Right</button>
              </div>
            </div>
            
            <!-- Options Sidebar -->
            <div class="ul-step2-sidebar">
              
              <!-- Color Selection -->
              <div class="ul-sidebar-section">
                <div class="ul-sidebar-title">T-Shirt Color</div>
                <div class="ul-color-grid" id="ul-color-grid">
                  <!-- Populated by JavaScript -->
                </div>
              </div>
              
              <!-- Size Selection -->
              <div class="ul-sidebar-section">
                <div class="ul-sidebar-title">Size</div>
                <select class="ul-size-select" id="ul-size-select">
                  <!-- Populated by JavaScript -->
                </select>
              </div>
              
              <!-- Print Locations -->
              <div class="ul-sidebar-section">
                <div class="ul-sidebar-title">Print Locations</div>
                <div class="ul-location-list" id="ul-location-list">
                  <label class="ul-location-item selected" data-location="front">
                    <div class="ul-location-check">
                      <input type="checkbox" class="ul-location-checkbox" data-location="front" checked>
                      <span class="ul-location-name">Front</span>
                    </div>
                    <span class="ul-location-price free">Included</span>
                  </label>
                  <label class="ul-location-item" data-location="back">
                    <div class="ul-location-check">
                      <input type="checkbox" class="ul-location-checkbox" data-location="back">
                      <span class="ul-location-name">Back</span>
                    </div>
                    <span class="ul-location-price">+$5.00</span>
                  </label>
                  <label class="ul-location-item" data-location="left_sleeve">
                    <div class="ul-location-check">
                      <input type="checkbox" class="ul-location-checkbox" data-location="left_sleeve">
                      <span class="ul-location-name">Left Sleeve</span>
                    </div>
                    <span class="ul-location-price">+$3.00</span>
                  </label>
                  <label class="ul-location-item" data-location="right_sleeve">
                    <div class="ul-location-check">
                      <input type="checkbox" class="ul-location-checkbox" data-location="right_sleeve">
                      <span class="ul-location-name">Right Sleeve</span>
                    </div>
                    <span class="ul-location-price">+$3.00</span>
                  </label>
                </div>
                
                <!-- Location Settings -->
                <div class="ul-location-settings visible" id="ul-location-settings">
                  <div class="ul-location-settings-title">Settings for: <span id="ul-settings-location-name">Front</span></div>
                  
                  <div class="ul-slider-group">
                    <div class="ul-slider-label">
                      <span>Scale</span>
                      <span class="ul-slider-value" id="ul-scale-value">100%</span>
                    </div>
                    <input type="range" class="ul-slider" id="ul-scale-slider" min="10" max="200" value="100" step="5">
                  </div>
                  
                  <div class="ul-slider-group">
                    <div class="ul-slider-label">
                      <span>Position X</span>
                      <span class="ul-slider-value" id="ul-pos-x-value">0</span>
                    </div>
                    <input type="range" class="ul-slider" id="ul-pos-x-slider" min="-100" max="100" value="0" step="1">
                  </div>
                  
                  <div class="ul-slider-group">
                    <div class="ul-slider-label">
                      <span>Position Y</span>
                      <span class="ul-slider-value" id="ul-pos-y-value">0</span>
                    </div>
                    <input type="range" class="ul-slider" id="ul-pos-y-slider" min="-100" max="100" value="0" step="1">
                  </div>
                </div>
              </div>
              
              <!-- Price Display -->
              <div class="ul-sidebar-section">
                <div class="ul-price-box">
                  <div class="ul-price-row">
                    <span>Base T-Shirt</span>
                    <span id="ul-price-base">$19.99</span>
                  </div>
                  <div class="ul-price-row" id="ul-price-locations-row" style="display: none;">
                    <span>Print Locations</span>
                    <span id="ul-price-locations">+$0.00</span>
                  </div>
                  <div class="ul-price-row" id="ul-price-size-row" style="display: none;">
                    <span>Size Modifier</span>
                    <span id="ul-price-size">+$0.00</span>
                  </div>
                  <div class="ul-price-row total">
                    <span>Subtotal</span>
                    <span id="ul-price-total">$19.99</span>
                  </div>
                </div>
              </div>
              
            </div>
          </div>
        </div>
        
        <!-- STEP 3: Details -->
        <div class="ul-step-panel" id="ul-step-3">
          <div class="ul-step3-content">
            
            <!-- Preview Summary -->
            <div class="ul-details-preview">
              <div class="ul-details-preview-thumbs" id="ul-details-thumbs">
                <div class="ul-details-preview-thumb">üñºÔ∏è</div>
              </div>
              <div class="ul-details-preview-info">
                <div class="ul-details-preview-title" id="ul-details-title">White T-Shirt, Large</div>
                <div class="ul-details-preview-meta" id="ul-details-meta">Locations: Front ‚Ä¢ Subtotal: $19.99</div>
              </div>
            </div>
            
            <!-- Quantity -->
            <div class="ul-question-group">
              <label class="ul-question-label">Quantity <span class="required">*</span></label>
              <div class="ul-quantity-control">
                <button type="button" class="ul-quantity-btn" id="ul-qty-minus">‚àí</button>
                <span class="ul-quantity-value" id="ul-qty-value">1</span>
                <button type="button" class="ul-quantity-btn" id="ul-qty-plus">+</button>
              </div>
            </div>
            
            <!-- Extra Questions Container -->
            <div id="ul-tshirt-extra-questions">
              <!-- Dynamically populated if merchant has extra questions -->
            </div>
            
            <!-- Special Instructions -->
            <div class="ul-question-group">
              <label class="ul-question-label" for="ul-special-instructions">Special Instructions (Optional)</label>
              <textarea class="ul-question-input ul-question-textarea" id="ul-special-instructions" placeholder="Any special requests for your order..."></textarea>
            </div>
            
          </div>
        </div>
        
        <!-- STEP 4: Review -->
        <div class="ul-step-panel" id="ul-step-4">
          <div class="ul-step4-content">
            
            <!-- Order Preview Card -->
            <div class="ul-review-card">
              <div class="ul-review-header">Order Preview</div>
              <div class="ul-review-body">
                
                <!-- Location Previews -->
                <div class="ul-review-preview-grid" id="ul-review-preview-grid">
                  <div class="ul-review-preview-item">
                    <div class="ul-review-preview-label">Front</div>
                    <div class="ul-review-preview-box">üëï</div>
                  </div>
                </div>
                
                <!-- Details List -->
                <ul class="ul-review-list" id="ul-review-list">
                  <li>
                    <span class="ul-review-list-label">Color</span>
                    <span class="ul-review-list-value" id="ul-review-color">White</span>
                  </li>
                  <li>
                    <span class="ul-review-list-label">Size</span>
                    <span class="ul-review-list-value" id="ul-review-size">Large</span>
                  </li>
                  <li>
                    <span class="ul-review-list-label">Quantity</span>
                    <span class="ul-review-list-value" id="ul-review-qty">1</span>
                  </li>
                  <li>
                    <span class="ul-review-list-label">Print Locations</span>
                    <span class="ul-review-list-value" id="ul-review-locations">Front</span>
                  </li>
                </ul>
                
                <!-- Price Breakdown -->
                <div class="ul-review-price-breakdown" id="ul-review-price-breakdown">
                  <div class="ul-review-price-row">
                    <span>Base T-Shirt</span>
                    <span id="ul-review-price-base">$19.99</span>
                  </div>
                  <div class="ul-review-price-row">
                    <span>Front Print</span>
                    <span>$0.00</span>
                  </div>
                  <div class="ul-review-price-row total">
                    <span>TOTAL</span>
                    <span id="ul-review-total">$19.99</span>
                  </div>
                </div>
                
              </div>
            </div>
            
            <!-- Confirmation Checkbox -->
            <div class="ul-confirmation">
              <label class="ul-confirmation-label">
                <input type="checkbox" class="ul-confirmation-checkbox" id="ul-confirm-checkbox">
                <span class="ul-confirmation-text">
                  I confirm this design is correct and ready for printing. I understand that returns are limited for custom items.
                </span>
              </label>
            </div>
            
            <!-- Action Buttons -->
            <div class="ul-action-buttons">
              <button type="button" class="ul-action-btn secondary" id="ul-design-another-btn" disabled>
                üé® Add to Cart & Design Another
              </button>
              <button type="button" class="ul-action-btn primary" id="ul-checkout-btn" disabled>
                üõí Add to Cart & Checkout
              </button>
            </div>
            
          </div>
        </div>
        
      </div>
    </div>
    
    <!-- Footer (Navigation) -->
    <div class="ul-tshirt-footer">
      <button type="button" class="ul-nav-btn back hidden" id="ul-nav-back">
        ‚Üê Back
      </button>
      <button type="button" class="ul-nav-btn next" id="ul-nav-next" disabled>
        Next: Design ‚Üí
      </button>
    </div>
    
  </div>
</div>

<!-- Toast Notification -->
<div class="ul-toast" id="ul-toast"></div>

<!-- Three.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js" defer></script>

<!-- OrbitControls CDN (separate module) -->
<script>
  // OrbitControls will be loaded dynamically in the JS
</script>

<!-- T-Shirt Modal Script -->
<script src="{{ 'tshirt-modal.js' | asset_url }}" defer></script>
