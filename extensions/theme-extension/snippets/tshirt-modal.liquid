{% comment %}
  T-Shirt Modal Snippet
  =====================
  FAZ 2: 4-Step Wizard + 3D Preview Modal
  FAZ 6: Mobile Experience + 3D Fallback
  
  Usage: {% render 'tshirt-modal' %}
  
  Features:
  - Step 1: Upload (inherited or new design)
  - Step 2: 3D Preview + Options (color, size, locations)
  - Step 3: Extra Questions
  - Step 4: Review & Actions
  - 3D Fallback for low-end devices (FAZ 6)
  
  Integration:
  - Listens for 'ul:openTShirtModal' event from DTF uploader
  - Uses Three.js for 3D rendering
  - Supports multi-location printing
  
  Version: 4.1.0
  Architecture: DTF_TSHIRT_MODAL_ARCHITECTURE.md
{% endcomment %}

<!-- DEBUG: tshirt-modal.liquid RENDERED -->
<script>console.log('[DEBUG] tshirt-modal.liquid snippet RENDERED on page');</script>

<!-- Load Separate CSS -->
{{ 'tshirt-modal.css' | asset_url | stylesheet_tag }}

<!-- Modal HTML -->
<div class="ul-tshirt-overlay" id="ul-tshirt-overlay">
  <div class="ul-tshirt-modal">
    
    <!-- Header -->
    <div class="ul-tshirt-header">
      <span class="ul-tshirt-title">üëï T-Shirt Designer</span>
      <button type="button" class="ul-tshirt-close" id="ul-tshirt-close" aria-label="Close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    
    <!-- Step Progress -->
    <div class="ul-tshirt-steps">
      <div class="ul-step-item active" data-step="1">
        <div class="ul-step-number">1</div>
        <span class="ul-step-label">Upload</span>
      </div>
      <div class="ul-step-connector"></div>
      <div class="ul-step-item" data-step="2">
        <div class="ul-step-number">2</div>
        <span class="ul-step-label">Design</span>
      </div>
      <div class="ul-step-connector"></div>
      <div class="ul-step-item" data-step="3">
        <div class="ul-step-number">3</div>
        <span class="ul-step-label">Details</span>
      </div>
      <div class="ul-step-connector"></div>
      <div class="ul-step-item" data-step="4">
        <div class="ul-step-number">4</div>
        <span class="ul-step-label">Review</span>
      </div>
    </div>
    
    <!-- Body -->
    <div class="ul-tshirt-body">
      <div class="ul-tshirt-content">
        
        <!-- STEP 1: Upload -->
        <div class="ul-step-panel active" id="ul-step-1">
          <div class="ul-step1-content">
            
            <!-- Inherited Design (shown if coming from DTF) -->
            <div id="ul-inherited-section" style="display: none;">
              <div class="ul-step1-section-title">Use Your Existing Design</div>
              <div class="ul-step1-section-desc">Your uploaded design is ready to use on a t-shirt.</div>
              
              <div class="ul-inherited-design" id="ul-inherited-design">
                <div class="ul-inherited-preview">
                  <img src="" alt="Design preview" class="ul-inherited-thumb" id="ul-inherited-thumb" width="80" height="80">
                  <div class="ul-inherited-info">
                    <div class="ul-inherited-name" id="ul-inherited-name">design.png</div>
                    <div class="ul-inherited-meta" id="ul-inherited-meta">2400 x 3200 px ‚Ä¢ 300 DPI</div>
                    <div class="ul-inherited-badge">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 6L9 17l-5-5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                      Already uploaded
                    </div>
                  </div>
                </div>
                <button type="button" class="ul-use-design-btn" id="ul-use-inherited-btn">
                  ‚úì Use This Design
                </button>
              </div>
              
              <div class="ul-divider"><span>OR</span></div>
            </div>
            
            <!-- Upload New Design -->
            <div id="ul-upload-section">
              <div class="ul-step1-section-title">Upload New Design</div>
              <div class="ul-step1-section-desc">Drag and drop or click to browse your files.</div>
              
              <div class="ul-upload-zone" id="ul-tshirt-upload-zone">
                <input type="file" id="ul-tshirt-file-input" accept=".png,.jpg,.jpeg,.svg,.webp" hidden>
                <div class="ul-upload-zone-icon">‚òÅÔ∏è</div>
                <div class="ul-upload-zone-text">Drag & Drop your design here</div>
                <div class="ul-upload-zone-hint">PNG, JPG, SVG, WEBP ‚Ä¢ Max 50MB</div>
                
                <div class="ul-upload-progress" id="ul-tshirt-upload-progress" style="display: none;">
                  <div class="ul-upload-progress-bar">
                    <div class="ul-upload-progress-fill" id="ul-tshirt-progress-fill"></div>
                  </div>
                  <div class="ul-upload-progress-text" id="ul-tshirt-progress-text">Uploading...</div>
                </div>
              </div>
              
              <!-- New upload preview (shown after upload) -->
              <div id="ul-new-upload-preview" style="display: none; margin-top: 16px;">
                <div class="ul-inherited-design selected">
                  <div class="ul-inherited-preview">
                    <img src="" alt="Uploaded design" class="ul-inherited-thumb" id="ul-new-upload-thumb" width="80" height="80">
                    <div class="ul-inherited-info">
                      <div class="ul-inherited-name" id="ul-new-upload-name">design.png</div>
                      <div class="ul-inherited-meta" id="ul-new-upload-meta">Uploaded successfully</div>
                      <div class="ul-inherited-badge">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M20 6L9 17l-5-5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Ready to use
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
          </div>
        </div>
        
        <!-- STEP 2: Design (3D + Options) -->
        <div class="ul-step-panel" id="ul-step-2">
          <div class="ul-step2-layout">
            
            <!-- 3D Preview -->
            <div class="ul-step2-3d">
              <div class="ul-3d-loading" id="ul-3d-loading">
                <div class="ul-3d-spinner"></div>
                <div>Loading 3D Preview...</div>
              </div>
              <canvas class="ul-3d-canvas" id="ul-3d-canvas"></canvas>
              
              <!-- Quick View Buttons -->
              <div class="ul-quick-views">
                <button type="button" class="ul-quick-view-btn active" data-view="front">Front</button>
                <button type="button" class="ul-quick-view-btn" data-view="back">Back</button>
                <button type="button" class="ul-quick-view-btn" data-view="left">Left</button>
                <button type="button" class="ul-quick-view-btn" data-view="right">Right</button>
              </div>
            </div>
            
            <!-- Options Sidebar -->
            <div class="ul-step2-sidebar">
              
              <!-- Color Selection -->
              <div class="ul-sidebar-section">
                <div class="ul-sidebar-title">T-Shirt Color</div>
                <div class="ul-color-grid" id="ul-color-grid">
                  <!-- Populated by JavaScript -->
                </div>
              </div>
              
              <!-- Size Selection -->
              <div class="ul-sidebar-section">
                <div class="ul-sidebar-title">Size</div>
                <select class="ul-size-select" id="ul-size-select">
                  <!-- Populated by JavaScript -->
                </select>
              </div>
              
              <!-- Print Locations -->
              <div class="ul-sidebar-section">
                <div class="ul-sidebar-title">Print Locations</div>
                <div class="ul-location-list" id="ul-location-list">
                  <label class="ul-location-item selected" data-location="front">
                    <div class="ul-location-check">
                      <input type="checkbox" class="ul-location-checkbox" data-location="front" checked>
                      <span class="ul-location-name">Front</span>
                    </div>
                    <span class="ul-location-price free">Included</span>
                  </label>
                  <label class="ul-location-item" data-location="back">
                    <div class="ul-location-check">
                      <input type="checkbox" class="ul-location-checkbox" data-location="back">
                      <span class="ul-location-name">Back</span>
                    </div>
                    <span class="ul-location-price">+$5.00</span>
                  </label>
                  <label class="ul-location-item" data-location="left_sleeve">
                    <div class="ul-location-check">
                      <input type="checkbox" class="ul-location-checkbox" data-location="left_sleeve">
                      <span class="ul-location-name">Left Sleeve</span>
                    </div>
                    <span class="ul-location-price">+$3.00</span>
                  </label>
                  <label class="ul-location-item" data-location="right_sleeve">
                    <div class="ul-location-check">
                      <input type="checkbox" class="ul-location-checkbox" data-location="right_sleeve">
                      <span class="ul-location-name">Right Sleeve</span>
                    </div>
                    <span class="ul-location-price">+$3.00</span>
                  </label>
                </div>
                
                <!-- Location Settings -->
                <div class="ul-location-settings visible" id="ul-location-settings">
                  <div class="ul-location-settings-title">Settings for: <span id="ul-settings-location-name">Front</span></div>
                  
                  <div class="ul-slider-group">
                    <div class="ul-slider-label">
                      <span>Scale</span>
                      <span class="ul-slider-value" id="ul-scale-value">100%</span>
                    </div>
                    <input type="range" class="ul-slider" id="ul-scale-slider" min="10" max="200" value="100" step="5">
                  </div>
                  
                  <div class="ul-slider-group">
                    <div class="ul-slider-label">
                      <span>Position X</span>
                      <span class="ul-slider-value" id="ul-pos-x-value">0</span>
                    </div>
                    <input type="range" class="ul-slider" id="ul-pos-x-slider" min="-100" max="100" value="0" step="1">
                  </div>
                  
                  <div class="ul-slider-group">
                    <div class="ul-slider-label">
                      <span>Position Y</span>
                      <span class="ul-slider-value" id="ul-pos-y-value">0</span>
                    </div>
                    <input type="range" class="ul-slider" id="ul-pos-y-slider" min="-100" max="100" value="0" step="1">
                  </div>
                </div>
              </div>
              
              <!-- Price Display -->
              <div class="ul-sidebar-section">
                <div class="ul-price-box">
                  <div class="ul-price-row">
                    <span>Base T-Shirt</span>
                    <span id="ul-price-base">$19.99</span>
                  </div>
                  <div class="ul-price-row" id="ul-price-locations-row" style="display: none;">
                    <span>Print Locations</span>
                    <span id="ul-price-locations">+$0.00</span>
                  </div>
                  <div class="ul-price-row" id="ul-price-size-row" style="display: none;">
                    <span>Size Modifier</span>
                    <span id="ul-price-size">+$0.00</span>
                  </div>
                  <div class="ul-price-row total">
                    <span>Subtotal</span>
                    <span id="ul-price-total">$19.99</span>
                  </div>
                </div>
              </div>
              
            </div>
          </div>
        </div>
        
        <!-- STEP 3: Details -->
        <div class="ul-step-panel" id="ul-step-3">
          <div class="ul-step3-content">
            
            <!-- Preview Summary -->
            <div class="ul-details-preview">
              <div class="ul-details-preview-thumbs" id="ul-details-thumbs">
                <div class="ul-details-preview-thumb">üñºÔ∏è</div>
              </div>
              <div class="ul-details-preview-info">
                <div class="ul-details-preview-title" id="ul-details-title">White T-Shirt, Large</div>
                <div class="ul-details-preview-meta" id="ul-details-meta">Locations: Front ‚Ä¢ Subtotal: $19.99</div>
              </div>
            </div>
            
            <!-- Quantity -->
            <div class="ul-question-group">
              <label class="ul-question-label">Quantity <span class="required">*</span></label>
              <div class="ul-quantity-control">
                <button type="button" class="ul-quantity-btn" id="ul-qty-minus">‚àí</button>
                <span class="ul-quantity-value" id="ul-qty-value">1</span>
                <button type="button" class="ul-quantity-btn" id="ul-qty-plus">+</button>
              </div>
            </div>
            
            <!-- Extra Questions Container -->
            <div id="ul-tshirt-extra-questions">
              <!-- Dynamically populated if merchant has extra questions -->
            </div>
            
            <!-- Special Instructions -->
            <div class="ul-question-group">
              <label class="ul-question-label" for="ul-special-instructions">Special Instructions (Optional)</label>
              <textarea class="ul-question-input ul-question-textarea" id="ul-special-instructions" placeholder="Any special requests for your order..."></textarea>
            </div>
            
          </div>
        </div>
        
        <!-- STEP 4: Review -->
        <div class="ul-step-panel" id="ul-step-4">
          <div class="ul-step4-content">
            
            <!-- Order Preview Card -->
            <div class="ul-review-card">
              <div class="ul-review-header">Order Preview</div>
              <div class="ul-review-body">
                
                <!-- Location Previews -->
                <div class="ul-review-preview-grid" id="ul-review-preview-grid">
                  <div class="ul-review-preview-item">
                    <div class="ul-review-preview-label">Front</div>
                    <div class="ul-review-preview-box">üëï</div>
                  </div>
                </div>
                
                <!-- Details List -->
                <ul class="ul-review-list" id="ul-review-list">
                  <li>
                    <span class="ul-review-list-label">Color</span>
                    <span class="ul-review-list-value" id="ul-review-color">White</span>
                  </li>
                  <li>
                    <span class="ul-review-list-label">Size</span>
                    <span class="ul-review-list-value" id="ul-review-size">Large</span>
                  </li>
                  <li>
                    <span class="ul-review-list-label">Quantity</span>
                    <span class="ul-review-list-value" id="ul-review-qty">1</span>
                  </li>
                  <li>
                    <span class="ul-review-list-label">Print Locations</span>
                    <span class="ul-review-list-value" id="ul-review-locations">Front</span>
                  </li>
                </ul>
                
                <!-- Price Breakdown -->
                <div class="ul-review-price-breakdown" id="ul-review-price-breakdown">
                  <div class="ul-review-price-row">
                    <span>Base T-Shirt</span>
                    <span id="ul-review-price-base">$19.99</span>
                  </div>
                  <div class="ul-review-price-row">
                    <span>Front Print</span>
                    <span>$0.00</span>
                  </div>
                  <div class="ul-review-price-row total">
                    <span>TOTAL</span>
                    <span id="ul-review-total">$19.99</span>
                  </div>
                </div>
                
              </div>
            </div>
            
            <!-- Confirmation Checkbox -->
            <div class="ul-confirmation">
              <label class="ul-confirmation-label">
                <input type="checkbox" class="ul-confirmation-checkbox" id="ul-confirm-checkbox">
                <span class="ul-confirmation-text">
                  I confirm this design is correct and ready for printing. I understand that returns are limited for custom items.
                </span>
              </label>
            </div>
            
            <!-- Action Buttons -->
            <div class="ul-action-buttons">
              <button type="button" class="ul-action-btn secondary" id="ul-design-another-btn" disabled>
                üé® Add to Cart & Design Another
              </button>
              <button type="button" class="ul-action-btn primary" id="ul-checkout-btn" disabled>
                üõí Add to Cart & Checkout
              </button>
            </div>
            
          </div>
        </div>
        
      </div>
    </div>
    
    <!-- Footer (Navigation) -->
    <div class="ul-tshirt-footer">
      <button type="button" class="ul-nav-btn back hidden" id="ul-nav-back">
        ‚Üê Back
      </button>
      <button type="button" class="ul-nav-btn next" id="ul-nav-next" disabled>
        Next: Design ‚Üí
      </button>
    </div>
    
  </div>
</div>

<!-- Toast Notification -->
<div class="ul-toast" id="ul-toast"></div>

<!-- Three.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js" defer></script>

<!-- GLTFLoader CDN for 3D model loading -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof THREE === 'undefined') return;
    
    // GLTFLoader implementation for loading GLB models
    THREE.GLTFLoader = function(manager) {
      THREE.Loader.call(this, manager);
    };
    
    THREE.GLTFLoader.prototype = Object.assign(Object.create(THREE.Loader.prototype), {
      constructor: THREE.GLTFLoader,
      
      load: function(url, onLoad, onProgress, onError) {
        const loader = new THREE.FileLoader(this.manager);
        loader.setResponseType('arraybuffer');
        loader.setRequestHeader(this.requestHeader);
        loader.setPath(this.path);
        loader.setWithCredentials(this.withCredentials);
        
        loader.load(url, (data) => {
          try {
            this.parse(data, this.resourcePath || url.substring(0, url.lastIndexOf('/') + 1), onLoad, onError);
          } catch (e) {
            if (onError) onError(e);
            console.error('THREE.GLTFLoader: Unable to parse model', e);
          }
        }, onProgress, onError);
      },
      
      parse: function(data, path, onLoad, onError) {
        // Simplified GLB parser
        const magic = new Uint32Array(data.slice(0, 4))[0];
        if (magic !== 0x46546C67) { // 'glTF' in ASCII
          if (onError) onError(new Error('Not a valid GLB file'));
          return;
        }
        
        const dataView = new DataView(data);
        const version = dataView.getUint32(4, true);
        const length = dataView.getUint32(8, true);
        
        let chunkOffset = 12;
        let jsonContent = null;
        let binBuffer = null;
        
        while (chunkOffset < length) {
          const chunkLength = dataView.getUint32(chunkOffset, true);
          const chunkType = dataView.getUint32(chunkOffset + 4, true);
          
          if (chunkType === 0x4E4F534A) { // JSON
            const jsonSlice = new Uint8Array(data, chunkOffset + 8, chunkLength);
            jsonContent = JSON.parse(new TextDecoder().decode(jsonSlice));
          } else if (chunkType === 0x004E4942) { // BIN
            binBuffer = data.slice(chunkOffset + 8, chunkOffset + 8 + chunkLength);
          }
          
          chunkOffset += chunkLength + 8;
        }
        
        if (!jsonContent) {
          if (onError) onError(new Error('Invalid GLB: no JSON chunk'));
          return;
        }
        
        // Parse geometry from glTF
        const scene = new THREE.Scene();
        
        // Simplified mesh extraction
        if (jsonContent.meshes && jsonContent.meshes.length > 0) {
          jsonContent.meshes.forEach((meshData) => {
            meshData.primitives.forEach((primitive) => {
              const geometry = new THREE.BufferGeometry();
              
              // Get accessors and buffer views
              const posAccessor = jsonContent.accessors[primitive.attributes.POSITION];
              const posBufferView = jsonContent.bufferViews[posAccessor.bufferView];
              
              // Extract position data
              const posData = new Float32Array(binBuffer, posBufferView.byteOffset || 0, posAccessor.count * 3);
              geometry.setAttribute('position', new THREE.BufferAttribute(posData.slice(), 3));
              
              // Normals if available
              if (primitive.attributes.NORMAL !== undefined) {
                const normAccessor = jsonContent.accessors[primitive.attributes.NORMAL];
                const normBufferView = jsonContent.bufferViews[normAccessor.bufferView];
                const normData = new Float32Array(binBuffer, normBufferView.byteOffset || 0, normAccessor.count * 3);
                geometry.setAttribute('normal', new THREE.BufferAttribute(normData.slice(), 3));
              }
              
              // UVs if available
              if (primitive.attributes.TEXCOORD_0 !== undefined) {
                const uvAccessor = jsonContent.accessors[primitive.attributes.TEXCOORD_0];
                const uvBufferView = jsonContent.bufferViews[uvAccessor.bufferView];
                const uvData = new Float32Array(binBuffer, uvBufferView.byteOffset || 0, uvAccessor.count * 2);
                geometry.setAttribute('uv', new THREE.BufferAttribute(uvData.slice(), 2));
              }
              
              // Indices if available
              if (primitive.indices !== undefined) {
                const indAccessor = jsonContent.accessors[primitive.indices];
                const indBufferView = jsonContent.bufferViews[indAccessor.bufferView];
                const IndArrayType = indAccessor.componentType === 5123 ? Uint16Array : Uint32Array;
                const indData = new IndArrayType(binBuffer, indBufferView.byteOffset || 0, indAccessor.count);
                geometry.setIndex(new THREE.BufferAttribute(indData.slice(), 1));
              }
              
              geometry.computeBoundingSphere();
              
              // Create material
              const material = new THREE.MeshStandardMaterial({
                color: 0xffffff,
                roughness: 0.7,
                metalness: 0.0,
                side: THREE.DoubleSide
              });
              
              const mesh = new THREE.Mesh(geometry, material);
              scene.add(mesh);
            });
          });
        }
        
        if (onLoad) onLoad({ scene: scene, scenes: [scene] });
      }
    });
  });
</script>

<!-- OrbitControls CDN (ES5 version for compatibility) -->
<script>
  // OrbitControls inline for compatibility (Three.js r160)
  // This is loaded after Three.js via defer
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof THREE === 'undefined') return;
    
    // Simple OrbitControls implementation for T-Shirt preview
    THREE.OrbitControls = function(camera, domElement) {
      this.camera = camera;
      this.domElement = domElement;
      this.enableDamping = true;
      this.dampingFactor = 0.05;
      this.enableZoom = true;
      this.enablePan = false;
      this.minDistance = 2;
      this.maxDistance = 10;
      this.autoRotate = false;
      this.autoRotateSpeed = 2.0;
      
      var scope = this;
      var spherical = { theta: 0, phi: Math.PI / 2, radius: camera.position.length() };
      var target = new THREE.Vector3(0, 0, 0);
      var isMouseDown = false;
      var previousMouse = { x: 0, y: 0 };
      
      function onMouseDown(e) {
        isMouseDown = true;
        previousMouse.x = e.clientX;
        previousMouse.y = e.clientY;
      }
      
      function onMouseMove(e) {
        if (!isMouseDown) return;
        var deltaX = e.clientX - previousMouse.x;
        var deltaY = e.clientY - previousMouse.y;
        spherical.theta -= deltaX * 0.005;
        spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi + deltaY * 0.005));
        previousMouse.x = e.clientX;
        previousMouse.y = e.clientY;
      }
      
      function onMouseUp() { isMouseDown = false; }
      
      function onWheel(e) {
        spherical.radius = Math.max(scope.minDistance, Math.min(scope.maxDistance, spherical.radius + e.deltaY * 0.01));
      }
      
      // Touch support
      function onTouchStart(e) {
        if (e.touches.length === 1) {
          isMouseDown = true;
          previousMouse.x = e.touches[0].clientX;
          previousMouse.y = e.touches[0].clientY;
        }
      }
      
      function onTouchMove(e) {
        if (!isMouseDown || e.touches.length !== 1) return;
        var deltaX = e.touches[0].clientX - previousMouse.x;
        var deltaY = e.touches[0].clientY - previousMouse.y;
        spherical.theta -= deltaX * 0.005;
        spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi + deltaY * 0.005));
        previousMouse.x = e.touches[0].clientX;
        previousMouse.y = e.touches[0].clientY;
      }
      
      function onTouchEnd() { isMouseDown = false; }
      
      domElement.addEventListener('mousedown', onMouseDown);
      domElement.addEventListener('mousemove', onMouseMove);
      domElement.addEventListener('mouseup', onMouseUp);
      domElement.addEventListener('mouseleave', onMouseUp);
      domElement.addEventListener('wheel', onWheel, { passive: true });
      domElement.addEventListener('touchstart', onTouchStart, { passive: true });
      domElement.addEventListener('touchmove', onTouchMove, { passive: true });
      domElement.addEventListener('touchend', onTouchEnd);
      
      this.update = function() {
        camera.position.x = target.x + spherical.radius * Math.sin(spherical.phi) * Math.sin(spherical.theta);
        camera.position.y = target.y + spherical.radius * Math.cos(spherical.phi);
        camera.position.z = target.z + spherical.radius * Math.sin(spherical.phi) * Math.cos(spherical.theta);
        camera.lookAt(target);
      };
      
      this.dispose = function() {
        domElement.removeEventListener('mousedown', onMouseDown);
        domElement.removeEventListener('mousemove', onMouseMove);
        domElement.removeEventListener('mouseup', onMouseUp);
        domElement.removeEventListener('mouseleave', onMouseUp);
        domElement.removeEventListener('wheel', onWheel);
        domElement.removeEventListener('touchstart', onTouchStart);
        domElement.removeEventListener('touchmove', onTouchMove);
        domElement.removeEventListener('touchend', onTouchEnd);
      };
    };
  });
</script>

<!-- FAZ 8: Analytics (conditional - may already be loaded by dtf-uploader) -->
<script>
  if (typeof ULAnalytics === 'undefined') {
    const script = document.createElement('script');
    script.src = '{{ 'ul-analytics.js' | asset_url }}';
    script.defer = true;
    document.head.appendChild(script);
  }
</script>

<!-- T-Shirt Modal Script -->
<script src="{{ 'tshirt-modal.js' | asset_url }}" defer></script>
