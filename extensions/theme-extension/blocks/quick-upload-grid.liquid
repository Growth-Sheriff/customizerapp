{% comment %}
  Upload Lift Pro - Quick Upload Grid Block
  Mode: quick (Mod-3)
  Location: Collection page / Product grid
{% endcomment %}

{% liquid
  comment
    Debug mode: Set to true to show block even when not configured
    Change to false in production
  endcomment
  assign debug_mode = false
%}

<div id="upload-lift-quick" class="ul-quick-grid" data-app-url="{{ shop.metafields.upload_lift.app_url | default: 'https://customizerapp.dev' }}" data-shop-domain="{{ shop.permanent_domain }}" data-debug="{{ debug_mode }}">
  {% for product in collection.products %}
    {% assign upload_config = product.metafields.upload_lift.config.value %}

    {% if upload_config != blank %}
      {% assign upload_enabled = upload_config.enabled | default: false %}
      {% assign upload_mode = upload_config.mode | default: 'classic' %}
    {% else %}
      {% assign upload_enabled = false %}
      {% assign upload_mode = 'classic' %}
    {% endif %}

    {% assign should_show = false %}
    {% if debug_mode %}
      {% assign should_show = true %}
    {% elsif upload_enabled == true and upload_mode == 'quick' %}
      {% assign should_show = true %}
    {% endif %}

    {% if should_show %}
    <div
      class="ul-quick-item"
      data-product-id="{{ product.id }}"
      data-variant-id="{{ product.selected_or_first_available_variant.id }}"
      data-product-title="{{ product.title | escape }}"
    >
      <div class="ul-quick-item-image">
        {% if product.featured_image %}
          <img src="{{ product.featured_image | image_url: width: 300 }}" alt="{{ product.title }}" width="300" height="300" loading="lazy">
        {% endif %}

        <div class="ul-quick-overlay">
          <button type="button" class="ul-quick-upload-btn">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/>
            </svg>
            <span>Upload Design</span>
          </button>
          <input type="file" class="ul-quick-file-input" accept=".png,.jpg,.jpeg,.pdf" style="display: none;">
        </div>
      </div>

      <div class="ul-quick-item-info">
        <h3 class="ul-quick-title">{{ product.title }}</h3>
        <p class="ul-quick-price">{{ product.price | money }}</p>
      </div>

      <!-- Upload progress (hidden by default) -->
      <div class="ul-quick-progress" style="display: none;">
        <div class="ul-quick-progress-bar">
          <div class="ul-quick-progress-fill"></div>
        </div>
        <p class="ul-quick-progress-text">Uploading...</p>
      </div>

      <!-- Success state (hidden by default) -->
      <div class="ul-quick-success" style="display: none;">
        <svg viewBox="0 0 24 24" width="20" height="20">
          <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        </svg>
        <span>Added to cart!</span>
      </div>
    </div>
    {% endif %}
  {% endfor %}
</div>

<style>
  .ul-quick-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    padding: 20px 0;
  }

  .ul-quick-item {
    border: 1px solid #dfe3e8;
    border-radius: 8px;
    overflow: hidden;
    background: #fff;
    transition: box-shadow 0.2s;
  }

  .ul-quick-item:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .ul-quick-item-image {
    position: relative;
    aspect-ratio: 1;
    overflow: hidden;
  }

  .ul-quick-item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .ul-quick-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.2s;
  }

  .ul-quick-item:hover .ul-quick-overlay {
    opacity: 1;
  }

  .ul-quick-upload-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 16px 24px;
    background: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    color: #5c6ac4;
    transition: transform 0.2s;
  }

  .ul-quick-upload-btn:hover {
    transform: scale(1.05);
  }

  .ul-quick-item-info {
    padding: 12px 16px;
  }

  .ul-quick-title {
    margin: 0 0 4px 0;
    font-size: 14px;
    font-weight: 600;
  }

  .ul-quick-price {
    margin: 0;
    font-size: 14px;
    color: #637381;
  }

  .ul-quick-progress {
    padding: 12px 16px;
    background: #f9fafb;
  }

  .ul-quick-progress-bar {
    height: 6px;
    background: #dfe3e8;
    border-radius: 3px;
    overflow: hidden;
  }

  .ul-quick-progress-fill {
    height: 100%;
    background: #5c6ac4;
    width: 0%;
    transition: width 0.3s;
  }

  .ul-quick-progress-text {
    margin: 8px 0 0 0;
    font-size: 12px;
    color: #637381;
    text-align: center;
  }

  .ul-quick-success {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 16px;
    background: #e3f1df;
    color: #108043;
    font-size: 14px;
    font-weight: 600;
  }
</style>

<script src="{{ 'upload-lift-core.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "UL Quick Grid",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Quick Upload Products"
    },
    {
      "type": "range",
      "id": "columns",
      "label": "Columns",
      "min": 2,
      "max": 5,
      "default": 4
    }
  ]
}
{% endschema %}

