{% comment %}
  3D Carousel with Upload - App Block
  6 Product Pickers, Each product individually selectable
{% endcomment %}

<div class="ul-carousel-section" data-block-id="{{ block.id }}">
  
  <!-- 4D Gold Foil Header -->
  {% if block.settings.show_header %}
  <div class="ul-section-header-4d">
    <div class="ul-header-deco-wrap">
      <div class="ul-header-side-deco ul-side-left">
        <span class="ul-deco-diamond"></span>
        <span class="ul-deco-line"></span>
      </div>
      <div class="ul-header-4d-container">
        <span class="ul-gold-corner ul-corner-tl"></span>
        <span class="ul-gold-corner ul-corner-tr"></span>
        <span class="ul-gold-corner ul-corner-bl"></span>
        <span class="ul-gold-corner ul-corner-br"></span>
        <div class="ul-header-4d-inner">
          <span class="ul-header-tag">{{ block.settings.header_tag | default: '✨ LIMITED TIME' }}</span>
          <h2 class="ul-header-title-4d">{{ block.settings.header_title | default: 'CUSTOM PRODUCTS' }}</h2>
          <p class="ul-header-subtitle">{{ block.settings.header_subtitle | default: 'Upload your design and create unique products' }}</p>
        </div>
      </div>
      <div class="ul-header-side-deco ul-side-right">
        <span class="ul-deco-line"></span>
        <span class="ul-deco-diamond"></span>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Products Carousel -->
  <div class="ul-carousel-container">
    <div class="ul-carousel-track" id="ulTrack-{{ block.id }}">
      
      {% assign products_array = "" | split: "," %}
      {% if block.settings.product_1 %}{% assign products_array = products_array | concat: block.settings.product_1 | split: "||SPLIT||" %}{% endif %}
      {% if block.settings.product_2 %}{% assign products_array = products_array | concat: block.settings.product_2 | split: "||SPLIT||" %}{% endif %}
      {% if block.settings.product_3 %}{% assign products_array = products_array | concat: block.settings.product_3 | split: "||SPLIT||" %}{% endif %}
      {% if block.settings.product_4 %}{% assign products_array = products_array | concat: block.settings.product_4 | split: "||SPLIT||" %}{% endif %}
      {% if block.settings.product_5 %}{% assign products_array = products_array | concat: block.settings.product_5 | split: "||SPLIT||" %}{% endif %}
      {% if block.settings.product_6 %}{% assign products_array = products_array | concat: block.settings.product_6 | split: "||SPLIT||" %}{% endif %}

      {% comment %} Product 1 {% endcomment %}
      {% assign p = block.settings.product_1 %}
      {% if p %}
      <div class="ul-carousel-card" data-product-id="{{ p.id }}" data-variant-id="{{ p.selected_or_first_available_variant.id }}" data-product-title="{{ p.title | escape }}" data-product-price="{{ p.price | money }}" data-product-image="{{ p.featured_image | image_url: width: 400 }}">
        <span class="ul-4d-badge">4D</span>
        <button class="ul-wishlist-btn" type="button"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button>
        <div class="ul-card-image"><a href="{{ p.url }}"><img src="{{ p.featured_image | image_url: width: 400 }}" alt="{{ p.title }}" loading="lazy"></a></div>
        <div class="ul-card-info">
          <span class="ul-card-vendor">{{ p.vendor | default: 'BRAND' }}</span>
          <h3 class="ul-card-title"><a href="{{ p.url }}">{{ p.title }}</a></h3>
          {% if block.settings.show_reviews %}<div class="ul-card-rating"><span class="ul-stars">★★★★★</span><span class="ul-rating-count">({{ block.settings.review_count_1 | default: 128 }})</span></div>{% endif %}
          <div class="ul-card-price">{% if p.compare_at_price > p.price %}<span class="ul-compare-price">{{ p.compare_at_price | money }}</span>{% endif %}<span class="ul-current-price">{{ p.price | money }}</span></div>
          <button class="ul-upload-btn" type="button" onclick="openUL3DModal(this)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg><span>{{ block.settings.upload_text | default: 'Upload Design' }}</span></button>
        </div>
      </div>
      {% endif %}

      {% comment %} Product 2 {% endcomment %}
      {% assign p = block.settings.product_2 %}
      {% if p %}
      <div class="ul-carousel-card" data-product-id="{{ p.id }}" data-variant-id="{{ p.selected_or_first_available_variant.id }}" data-product-title="{{ p.title | escape }}" data-product-price="{{ p.price | money }}" data-product-image="{{ p.featured_image | image_url: width: 400 }}">
        <span class="ul-4d-badge">4D</span>
        <button class="ul-wishlist-btn" type="button"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button>
        <div class="ul-card-image"><a href="{{ p.url }}"><img src="{{ p.featured_image | image_url: width: 400 }}" alt="{{ p.title }}" loading="lazy"></a></div>
        <div class="ul-card-info">
          <span class="ul-card-vendor">{{ p.vendor | default: 'BRAND' }}</span>
          <h3 class="ul-card-title"><a href="{{ p.url }}">{{ p.title }}</a></h3>
          {% if block.settings.show_reviews %}<div class="ul-card-rating"><span class="ul-stars">★★★★★</span><span class="ul-rating-count">({{ block.settings.review_count_2 | default: 95 }})</span></div>{% endif %}
          <div class="ul-card-price">{% if p.compare_at_price > p.price %}<span class="ul-compare-price">{{ p.compare_at_price | money }}</span>{% endif %}<span class="ul-current-price">{{ p.price | money }}</span></div>
          <button class="ul-upload-btn" type="button" onclick="openUL3DModal(this)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg><span>{{ block.settings.upload_text | default: 'Upload Design' }}</span></button>
        </div>
      </div>
      {% endif %}

      {% comment %} Product 3 {% endcomment %}
      {% assign p = block.settings.product_3 %}
      {% if p %}
      <div class="ul-carousel-card" data-product-id="{{ p.id }}" data-variant-id="{{ p.selected_or_first_available_variant.id }}" data-product-title="{{ p.title | escape }}" data-product-price="{{ p.price | money }}" data-product-image="{{ p.featured_image | image_url: width: 400 }}">
        <span class="ul-4d-badge">4D</span>
        <button class="ul-wishlist-btn" type="button"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button>
        <div class="ul-card-image"><a href="{{ p.url }}"><img src="{{ p.featured_image | image_url: width: 400 }}" alt="{{ p.title }}" loading="lazy"></a></div>
        <div class="ul-card-info">
          <span class="ul-card-vendor">{{ p.vendor | default: 'BRAND' }}</span>
          <h3 class="ul-card-title"><a href="{{ p.url }}">{{ p.title }}</a></h3>
          {% if block.settings.show_reviews %}<div class="ul-card-rating"><span class="ul-stars">★★★★★</span><span class="ul-rating-count">({{ block.settings.review_count_3 | default: 203 }})</span></div>{% endif %}
          <div class="ul-card-price">{% if p.compare_at_price > p.price %}<span class="ul-compare-price">{{ p.compare_at_price | money }}</span>{% endif %}<span class="ul-current-price">{{ p.price | money }}</span></div>
          <button class="ul-upload-btn" type="button" onclick="openUL3DModal(this)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg><span>{{ block.settings.upload_text | default: 'Upload Design' }}</span></button>
        </div>
      </div>
      {% endif %}

      {% comment %} Product 4 {% endcomment %}
      {% assign p = block.settings.product_4 %}
      {% if p %}
      <div class="ul-carousel-card" data-product-id="{{ p.id }}" data-variant-id="{{ p.selected_or_first_available_variant.id }}" data-product-title="{{ p.title | escape }}" data-product-price="{{ p.price | money }}" data-product-image="{{ p.featured_image | image_url: width: 400 }}">
        <span class="ul-4d-badge">4D</span>
        <button class="ul-wishlist-btn" type="button"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button>
        <div class="ul-card-image"><a href="{{ p.url }}"><img src="{{ p.featured_image | image_url: width: 400 }}" alt="{{ p.title }}" loading="lazy"></a></div>
        <div class="ul-card-info">
          <span class="ul-card-vendor">{{ p.vendor | default: 'BRAND' }}</span>
          <h3 class="ul-card-title"><a href="{{ p.url }}">{{ p.title }}</a></h3>
          {% if block.settings.show_reviews %}<div class="ul-card-rating"><span class="ul-stars">★★★★★</span><span class="ul-rating-count">({{ block.settings.review_count_4 | default: 67 }})</span></div>{% endif %}
          <div class="ul-card-price">{% if p.compare_at_price > p.price %}<span class="ul-compare-price">{{ p.compare_at_price | money }}</span>{% endif %}<span class="ul-current-price">{{ p.price | money }}</span></div>
          <button class="ul-upload-btn" type="button" onclick="openUL3DModal(this)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg><span>{{ block.settings.upload_text | default: 'Upload Design' }}</span></button>
        </div>
      </div>
      {% endif %}

      {% comment %} Product 5 {% endcomment %}
      {% assign p = block.settings.product_5 %}
      {% if p %}
      <div class="ul-carousel-card" data-product-id="{{ p.id }}" data-variant-id="{{ p.selected_or_first_available_variant.id }}" data-product-title="{{ p.title | escape }}" data-product-price="{{ p.price | money }}" data-product-image="{{ p.featured_image | image_url: width: 400 }}">
        <span class="ul-4d-badge">4D</span>
        <button class="ul-wishlist-btn" type="button"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button>
        <div class="ul-card-image"><a href="{{ p.url }}"><img src="{{ p.featured_image | image_url: width: 400 }}" alt="{{ p.title }}" loading="lazy"></a></div>
        <div class="ul-card-info">
          <span class="ul-card-vendor">{{ p.vendor | default: 'BRAND' }}</span>
          <h3 class="ul-card-title"><a href="{{ p.url }}">{{ p.title }}</a></h3>
          {% if block.settings.show_reviews %}<div class="ul-card-rating"><span class="ul-stars">★★★★★</span><span class="ul-rating-count">({{ block.settings.review_count_5 | default: 156 }})</span></div>{% endif %}
          <div class="ul-card-price">{% if p.compare_at_price > p.price %}<span class="ul-compare-price">{{ p.compare_at_price | money }}</span>{% endif %}<span class="ul-current-price">{{ p.price | money }}</span></div>
          <button class="ul-upload-btn" type="button" onclick="openUL3DModal(this)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg><span>{{ block.settings.upload_text | default: 'Upload Design' }}</span></button>
        </div>
      </div>
      {% endif %}

      {% comment %} Product 6 {% endcomment %}
      {% assign p = block.settings.product_6 %}
      {% if p %}
      <div class="ul-carousel-card" data-product-id="{{ p.id }}" data-variant-id="{{ p.selected_or_first_available_variant.id }}" data-product-title="{{ p.title | escape }}" data-product-price="{{ p.price | money }}" data-product-image="{{ p.featured_image | image_url: width: 400 }}">
        <span class="ul-4d-badge">4D</span>
        <button class="ul-wishlist-btn" type="button"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button>
        <div class="ul-card-image"><a href="{{ p.url }}"><img src="{{ p.featured_image | image_url: width: 400 }}" alt="{{ p.title }}" loading="lazy"></a></div>
        <div class="ul-card-info">
          <span class="ul-card-vendor">{{ p.vendor | default: 'BRAND' }}</span>
          <h3 class="ul-card-title"><a href="{{ p.url }}">{{ p.title }}</a></h3>
          {% if block.settings.show_reviews %}<div class="ul-card-rating"><span class="ul-stars">★★★★★</span><span class="ul-rating-count">({{ block.settings.review_count_6 | default: 89 }})</span></div>{% endif %}
          <div class="ul-card-price">{% if p.compare_at_price > p.price %}<span class="ul-compare-price">{{ p.compare_at_price | money }}</span>{% endif %}<span class="ul-current-price">{{ p.price | money }}</span></div>
          <button class="ul-upload-btn" type="button" onclick="openUL3DModal(this)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg><span>{{ block.settings.upload_text | default: 'Upload Design' }}</span></button>
        </div>
      </div>
      {% endif %}

      {% comment %} No products message {% endcomment %}
      {% unless block.settings.product_1 or block.settings.product_2 or block.settings.product_3 or block.settings.product_4 or block.settings.product_5 or block.settings.product_6 %}
        <p style="padding:30px;color:#666;text-align:center;width:100%;">Select products in block settings (Product 1-6)</p>
      {% endunless %}
    </div>

    <!-- Nav Arrows -->
    <button class="ul-carousel-prev" onclick="slideUL3D('{{ block.id }}',-1)"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg></button>
    <button class="ul-carousel-next" onclick="slideUL3D('{{ block.id }}',1)"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg></button>
  </div>
</div>

<!-- Upload Modal -->
<div class="ul-modal-overlay" id="ulModal-{{ block.id }}">
  <div class="ul-modal">
    <div class="ul-modal-header">
      <h3>Upload Your Design</h3>
      <button class="ul-modal-close" onclick="closeUL3DModal('{{ block.id }}')">×</button>
    </div>
    <div class="ul-modal-body">
      <div class="ul-modal-product">
        <img id="ulModalImg-{{ block.id }}" src="" alt="">
        <div>
          <strong id="ulModalTitle-{{ block.id }}"></strong>
          <span id="ulModalPrice-{{ block.id }}"></span>
        </div>
      </div>
      <div class="ul-upload-zone" id="ulUploadZone-{{ block.id }}" onclick="document.getElementById('ulFileInput-{{ block.id }}').click()">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#7367f0" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        <p>Click to upload or drag & drop</p>
        <input type="file" id="ulFileInput-{{ block.id }}" accept="image/*,.pdf" style="display:none" onchange="handleUL3DFile(event,'{{ block.id }}')">
      </div>
      <div class="ul-preview-zone" id="ulPreviewZone-{{ block.id }}" style="display:none">
        <img id="ulPreviewImg-{{ block.id }}" src="">
        <button class="ul-remove-btn" onclick="removeUL3DFile('{{ block.id }}')">×</button>
      </div>
      <div class="ul-size-section">
        <label>Sheet Size:</label>
        <select class="ul-size-select" id="ulSizeSelect-{{ block.id }}" onchange="selectUL3DSize(this,'{{ block.id }}')">
          <option value="22x6" data-price="7.50">22" x 6" - $7.50</option>
          <option value="22x12" data-price="12.00" selected>22" x 12" - $12.00</option>
          <option value="22x24" data-price="22.00">22" x 24" - $22.00</option>
          <option value="22x60" data-price="50.00">22" x 60" - $50.00</option>
        </select>
      </div>
      <div class="ul-qty-row">
        <span>Quantity:</span>
        <div class="ul-qty-controls">
          <button onclick="changeUL3DQty('{{ block.id }}',-1)">−</button>
          <input type="number" id="ulQtyInput-{{ block.id }}" value="1" min="1">
          <button onclick="changeUL3DQty('{{ block.id }}',1)">+</button>
        </div>
      </div>
    </div>
    <div class="ul-modal-footer">
      <button class="ul-modal-cart-btn" id="ulCartBtn-{{ block.id }}" onclick="addUL3DToCart('{{ block.id }}')" disabled>Upload design to continue</button>
    </div>
  </div>
</div>

<style>
.ul-carousel-section{padding:20px 0;max-width:1400px;margin:0 auto}
.ul-section-header-4d{text-align:center;margin-bottom:30px}
.ul-header-deco-wrap{display:flex;align-items:center;justify-content:center;gap:20px}
.ul-header-side-deco{display:flex;align-items:center;gap:8px}
.ul-deco-diamond{width:10px;height:10px;background:linear-gradient(135deg,#ffd700,#ffaa00);transform:rotate(45deg)}
.ul-deco-line{width:60px;height:2px;background:linear-gradient(90deg,transparent,#ffd700,transparent)}
.ul-header-4d-container{position:relative;padding:20px 40px;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);border-radius:16px}
.ul-gold-corner{position:absolute;width:20px;height:20px;border:2px solid #ffd700}
.ul-corner-tl{top:-2px;left:-2px;border-right:0;border-bottom:0;border-radius:8px 0 0 0}
.ul-corner-tr{top:-2px;right:-2px;border-left:0;border-bottom:0;border-radius:0 8px 0 0}
.ul-corner-bl{bottom:-2px;left:-2px;border-right:0;border-top:0;border-radius:0 0 0 8px}
.ul-corner-br{bottom:-2px;right:-2px;border-left:0;border-top:0;border-radius:0 0 8px 0}
.ul-header-4d-inner{text-align:center}
.ul-header-tag{display:inline-block;background:linear-gradient(135deg,#ff6b6b,#ee5a24);color:#fff;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;margin-bottom:8px}
.ul-header-title-4d{font-size:28px;font-weight:800;background:linear-gradient(135deg,#ffd700 0%,#ffaa00 50%,#ffd700 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:0}
.ul-header-subtitle{color:#a0a0a0;font-size:14px;margin:8px 0 0}
.ul-carousel-container{position:relative;padding:0 50px}
.ul-carousel-track{display:flex;gap:20px;overflow-x:auto;scroll-behavior:smooth;padding:10px 0;scrollbar-width:none}
.ul-carousel-track::-webkit-scrollbar{display:none}
.ul-carousel-card{flex:0 0 280px;background:#fff;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08);overflow:hidden;position:relative;transition:transform .3s,box-shadow .3s}
.ul-carousel-card:hover{transform:translateY(-8px);box-shadow:0 12px 40px rgba(115,103,240,0.2)}
.ul-4d-badge{position:absolute;top:12px;left:12px;background:linear-gradient(135deg,#ffd700,#ffaa00);color:#1a1a2e;padding:4px 10px;border-radius:6px;font-size:11px;font-weight:700;z-index:2}
.ul-wishlist-btn{position:absolute;top:12px;right:12px;width:36px;height:36px;border-radius:50%;background:#fff;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(0,0,0,0.1);z-index:2;transition:all .2s}
.ul-wishlist-btn:hover{background:#ff6b6b}
.ul-wishlist-btn:hover svg{stroke:#fff}
.ul-card-image{aspect-ratio:1;overflow:hidden;background:#f8f9fa}
.ul-card-image img{width:100%;height:100%;object-fit:cover;transition:transform .3s}
.ul-carousel-card:hover .ul-card-image img{transform:scale(1.05)}
.ul-card-info{padding:16px}
.ul-card-vendor{font-size:11px;color:#7367f0;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
.ul-card-title{margin:6px 0;font-size:15px;font-weight:600}
.ul-card-title a{color:#1a1a2e;text-decoration:none}
.ul-card-rating{display:flex;align-items:center;gap:6px;margin:8px 0}
.ul-stars{color:#ffd700;font-size:14px}
.ul-rating-count{font-size:12px;color:#888}
.ul-card-price{margin:10px 0}
.ul-compare-price{text-decoration:line-through;color:#999;font-size:13px;margin-right:8px}
.ul-current-price{font-size:18px;font-weight:700;color:#1a1a2e}
.ul-upload-btn{width:100%;padding:12px;background:linear-gradient(135deg,#7367f0 0%,#9d4edd 100%);color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all .3s}
.ul-upload-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(115,103,240,0.4)}
.ul-carousel-prev,.ul-carousel-next{position:absolute;top:50%;transform:translateY(-50%);width:44px;height:44px;border-radius:50%;background:#fff;border:none;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,0.1);display:flex;align-items:center;justify-content:center;z-index:10;transition:all .2s}
.ul-carousel-prev{left:0}
.ul-carousel-next{right:0}
.ul-carousel-prev:hover,.ul-carousel-next:hover{background:#7367f0}
.ul-carousel-prev:hover svg,.ul-carousel-next:hover svg{stroke:#fff}
.ul-modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:9999;backdrop-filter:blur(4px)}
.ul-modal-overlay.active{display:flex}
.ul-modal{background:#fff;border-radius:16px;width:90%;max-width:420px;max-height:90vh;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
.ul-modal-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:linear-gradient(135deg,#7367f0,#9d4edd);color:#fff}
.ul-modal-header h3{margin:0;font-size:18px}
.ul-modal-close{background:none;border:none;color:#fff;font-size:28px;cursor:pointer;line-height:1}
.ul-modal-body{padding:20px}
.ul-modal-product{display:flex;align-items:center;gap:12px;padding:12px;background:#f8f9fa;border-radius:10px;margin-bottom:16px}
.ul-modal-product img{width:60px;height:60px;border-radius:8px;object-fit:cover}
.ul-modal-product strong{display:block;font-size:14px}
.ul-modal-product span{color:#7367f0;font-weight:600;font-size:14px}
.ul-upload-zone{border:2px dashed #7367f0;border-radius:12px;padding:30px;text-align:center;cursor:pointer;background:#f8f7ff;transition:all .3s}
.ul-upload-zone:hover{background:#f0eeff}
.ul-upload-zone p{margin:10px 0 0;color:#666}
.ul-preview-zone{position:relative;text-align:center;margin-bottom:16px}
.ul-preview-zone img{max-width:100%;max-height:150px;border-radius:10px}
.ul-remove-btn{position:absolute;top:5px;right:5px;background:#ff4757;color:#fff;border:none;width:28px;height:28px;border-radius:50%;cursor:pointer;font-size:16px}
.ul-size-section{margin-bottom:16px}
.ul-size-section label{display:block;margin-bottom:8px;font-weight:600;font-size:14px}
.ul-size-select{width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:10px;font-size:14px;cursor:pointer}
.ul-size-select:focus{border-color:#7367f0;outline:none}
.ul-qty-row{display:flex;justify-content:space-between;align-items:center}
.ul-qty-controls{display:flex;align-items:center;gap:8px}
.ul-qty-controls button{width:36px;height:36px;border:1px solid #ddd;border-radius:8px;background:#fff;font-size:18px;cursor:pointer}
.ul-qty-controls button:hover{background:#7367f0;color:#fff;border-color:#7367f0}
.ul-qty-controls input{width:50px;text-align:center;border:1px solid #ddd;border-radius:8px;padding:8px;font-size:14px}
.ul-modal-footer{padding:16px 20px;background:#f8f9fa;border-top:1px solid #eee}
.ul-modal-cart-btn{width:100%;padding:14px;background:linear-gradient(135deg,#28c76f,#48da89);color:#fff;border:none;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;transition:all .3s}
.ul-modal-cart-btn:disabled{background:#ccc;cursor:not-allowed}
.ul-modal-cart-btn:not(:disabled):hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(40,199,111,0.4)}
@media(max-width:768px){.ul-carousel-card{flex:0 0 260px}.ul-carousel-container{padding:0 40px}.ul-header-title-4d{font-size:22px}}
</style>

<script>
(function(){
  window.ul3dData=window.ul3dData||{};
  window.slideUL3D=function(id,dir){var t=document.getElementById('ulTrack-'+id);if(t)t.scrollBy({left:dir*300,behavior:'smooth'})};
  window.openUL3DModal=function(btn){var c=btn.closest('.ul-carousel-card'),sec=btn.closest('.ul-carousel-section'),bid=sec.dataset.blockId;if(c&&bid){ul3dData[bid]={vid:c.dataset.variantId,file:null,size:'22x12',price:12};document.getElementById('ulModalImg-'+bid).src=c.dataset.productImage;document.getElementById('ulModalTitle-'+bid).textContent=c.dataset.productTitle;document.getElementById('ulModalPrice-'+bid).textContent=c.dataset.productPrice;document.getElementById('ulModal-'+bid).classList.add('active');document.body.style.overflow='hidden'}};
  window.closeUL3DModal=function(bid){document.getElementById('ulModal-'+bid).classList.remove('active');document.body.style.overflow=''};
  window.handleUL3DFile=function(e,bid){var f=e.target.files[0];if(!f)return;ul3dData[bid].file=f;document.getElementById('ulUploadZone-'+bid).style.display='none';document.getElementById('ulPreviewZone-'+bid).style.display='block';document.getElementById('ulPreviewImg-'+bid).src=URL.createObjectURL(f);document.getElementById('ulCartBtn-'+bid).disabled=false;document.getElementById('ulCartBtn-'+bid).textContent='Add to Cart'};
  window.removeUL3DFile=function(bid){ul3dData[bid].file=null;document.getElementById('ulUploadZone-'+bid).style.display='';document.getElementById('ulPreviewZone-'+bid).style.display='none';document.getElementById('ulFileInput-'+bid).value='';document.getElementById('ulCartBtn-'+bid).disabled=true;document.getElementById('ulCartBtn-'+bid).textContent='Upload design to continue'};
  window.selectUL3DSize=function(sel,bid){ul3dData[bid].size=sel.value;ul3dData[bid].price=parseFloat(sel.options[sel.selectedIndex].dataset.price)};
  window.changeUL3DQty=function(bid,d){var i=document.getElementById('ulQtyInput-'+bid),v=parseInt(i.value)+d;if(v<1)v=1;i.value=v};
  window.addUL3DToCart=function(bid){var btn=document.getElementById('ulCartBtn-'+bid),qty=parseInt(document.getElementById('ulQtyInput-'+bid).value)||1;btn.disabled=true;btn.textContent='Adding...';fetch('/cart/add.js',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({items:[{id:ul3dData[bid].vid,quantity:qty,properties:{'_upload_file':ul3dData[bid].file?.name||'','_sheet_size':ul3dData[bid].size,'_unit_price':'$'+ul3dData[bid].price}}]})}).then(function(r){return r.json()}).then(function(){btn.textContent='✓ Added!';setTimeout(function(){closeUL3DModal(bid);window.location.href='/cart'},800)}).catch(function(){btn.disabled=false;btn.textContent='Add to Cart'})};
  document.addEventListener('click',function(e){if(e.target.classList.contains('ul-modal-overlay'))closeUL3DModal(e.target.id.replace('ulModal-',''))});
})();
</script>

{% schema %}
{
  "name": "3D Carousel Upload",
  "target": "section",
  "settings": [
    {
      "type": "header",
      "content": "Header Settings"
    },
    {
      "type": "checkbox",
      "id": "show_header",
      "label": "Show 4D Header",
      "default": true
    },
    {
      "type": "text",
      "id": "header_tag",
      "label": "Header Tag",
      "default": "✨ LIMITED TIME"
    },
    {
      "type": "text",
      "id": "header_title",
      "label": "Header Title",
      "default": "CUSTOM PRODUCTS"
    },
    {
      "type": "text",
      "id": "header_subtitle",
      "label": "Header Subtitle",
      "default": "Upload your design and create unique products"
    },
    {
      "type": "header",
      "content": "Product 1"
    },
    {
      "type": "product",
      "id": "product_1",
      "label": "Product 1"
    },
    {
      "type": "number",
      "id": "review_count_1",
      "label": "Review Count",
      "default": 128
    },
    {
      "type": "header",
      "content": "Product 2"
    },
    {
      "type": "product",
      "id": "product_2",
      "label": "Product 2"
    },
    {
      "type": "number",
      "id": "review_count_2",
      "label": "Review Count",
      "default": 95
    },
    {
      "type": "header",
      "content": "Product 3"
    },
    {
      "type": "product",
      "id": "product_3",
      "label": "Product 3"
    },
    {
      "type": "number",
      "id": "review_count_3",
      "label": "Review Count",
      "default": 203
    },
    {
      "type": "header",
      "content": "Product 4"
    },
    {
      "type": "product",
      "id": "product_4",
      "label": "Product 4"
    },
    {
      "type": "number",
      "id": "review_count_4",
      "label": "Review Count",
      "default": 67
    },
    {
      "type": "header",
      "content": "Product 5"
    },
    {
      "type": "product",
      "id": "product_5",
      "label": "Product 5"
    },
    {
      "type": "number",
      "id": "review_count_5",
      "label": "Review Count",
      "default": 156
    },
    {
      "type": "header",
      "content": "Product 6"
    },
    {
      "type": "product",
      "id": "product_6",
      "label": "Product 6"
    },
    {
      "type": "number",
      "id": "review_count_6",
      "label": "Review Count",
      "default": 89
    },
    {
      "type": "header",
      "content": "Display Settings"
    },
    {
      "type": "checkbox",
      "id": "show_reviews",
      "label": "Show Reviews",
      "default": true
    },
    {
      "type": "text",
      "id": "upload_text",
      "label": "Upload Button Text",
      "default": "Upload Design"
    }
  ]
}
{% endschema %}
