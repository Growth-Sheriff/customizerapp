{% comment %}
  Product 3D Customizer & Upload - DTF Transfer Block
  =====================================
  Mode: dtf_transfer (Mod-1)
  Location: Product page
  
  This block renders the DTF uploader widget with:
  - File upload (drag & drop)
  - Extra questions from merchant config
  - Size & quantity selection
  - T-Shirt addon modal (if enabled)
  - Confirmation screen after cart add
  
  USAGE: Add this block to your product page in Theme Editor
  
  Version: 4.1.0 (FAZ 6 - Mobile Experience)
{% endcomment %}

{% comment %}
  Load Remote Logger (DEBUG)
  Captures console logs and sends to server
{% endcomment %}
<script src="{{ 'ul-remote-logger.js' | asset_url }}"></script>

{% comment %}
  Mobile-First Ordering: App blocks appear right after product-main on mobile
  Forces all app blocks to display before other sections
{% endcomment %}
<style>
  @media (max-width: 749px) {
    /* 
      Strategy: Make product page a flex column and reorder sections
      App blocks should come immediately after main product section
    */
    
    /* Target main product page wrapper - common Shopify theme patterns */
    #MainContent,
    main,
    .main-content,
    [role="main"],
    .shopify-section-group-main,
    .product-template,
    #shopify-section-product,
    #shopify-section-main-product {
      display: flex !important;
      flex-direction: column !important;
    }
    
    /* Main product section stays at top */
    .shopify-section--main-product,
    .shopify-section[id*="product"],
    #shopify-section-product,
    #shopify-section-main-product,
    .product-section,
    section.product {
      order: 1 !important;
    }
    
    /* ALL app blocks come right after main product (order: 2) */
    .shopify-section[id*="apps"],
    [class*="shopify-app-block"],
    [data-shopify-editor-block],
    .shopify-block,
    div[id^="shopify-block-"] {
      order: 2 !important;
    }
    
    /* Other sections come after app blocks (order: 10+) */
    .shopify-section:not(.shopify-section--main-product):not([id*="product"]):not([id*="apps"]) {
      order: 10 !important;
    }
    
    /* Specifically push related products, recommendations, reviews to bottom */
    .shopify-section[id*="related"],
    .shopify-section[id*="recommend"],
    .shopify-section[id*="review"],
    .shopify-section[id*="featured"],
    .shopify-section[id*="collection"],
    [class*="related-products"],
    [class*="product-recommendations"] {
      order: 20 !important;
    }
    
    /* Within product info area - ensure app blocks inside are also prioritized */
    .product__info-container,
    .product-info,
    .product__column,
    .product-single__meta,
    .product-main {
      display: flex !important;
      flex-direction: column !important;
    }
    
    /* DTF block specifically gets highest priority within app blocks */
    .ul-dtf-main,
    [data-shopify-editor-block]:has(.ul-dtf-main) {
      order: -1 !important;
    }
  }
</style>

{% comment %}
  Load Global State Manager (FAZ 4)
  MUST load before other components
{% endcomment %}
<script src="{{ 'ul-state.js' | asset_url }}" defer></script>

{% comment %}
  Render the DTF Uploader snippet
  This handles all the upload logic, API calls, and UI
{% endcomment %}
{% render 'dtf-uploader', product: product %}

{% comment %}
  Render the T-Shirt Modal snippet (FAZ 2)
  This provides the 4-step wizard for T-Shirt customization
{% endcomment %}
{% render 'tshirt-modal' %}

{% comment %}
  Render the Confirmation Screen snippet (FAZ 3)
  This shows cart summary after successful addition
{% endcomment %}
{% render 'confirmation-screen' %}

{% schema %}
{
  "name": "Product 3D Customizer",
  "target": "section",
  "templates": ["product"],
  "settings": [
    {
      "type": "paragraph",
      "content": "This block displays the DTF upload widget and 3D T-Shirt designer. Configure product settings in the Product 3D Customizer app dashboard."
    },
    {
      "type": "checkbox",
      "id": "show_header",
      "label": "Show section header",
      "default": true
    },
    {
      "type": "text",
      "id": "header_text",
      "label": "Header text",
      "default": "Upload Your Design"
    }
  ]
}
{% endschema %}
