(function(){
  window.ul3dData=window.ul3dData||{};
  window.slideUL3D=function(id,dir){var t=document.getElementById('ulTrack-'+id);if(t)t.scrollBy({left:dir*300,behavior:'smooth'})};
  window.openUL3DModal=function(btn){var c=btn.closest('.ul-carousel-card'),sec=btn.closest('.ul-carousel-section'),bid=sec.dataset.blockId;if(c&&bid){ul3dData[bid]={vid:c.dataset.variantId,file:null,size:'22x12',price:12};document.getElementById('ulModalImg-'+bid).src=c.dataset.productImage;document.getElementById('ulModalTitle-'+bid).textContent=c.dataset.productTitle;document.getElementById('ulModalPrice-'+bid).textContent=c.dataset.productPrice;document.getElementById('ulModal-'+bid).classList.add('active');document.body.style.overflow='hidden'}};
  window.closeUL3DModal=function(bid){document.getElementById('ulModal-'+bid).classList.remove('active');document.body.style.overflow=''};
  window.handleUL3DFile=function(e,bid){var f=e.target.files[0];if(!f)return;ul3dData[bid].file=f;document.getElementById('ulUploadZone-'+bid).style.display='none';document.getElementById('ulPreviewZone-'+bid).style.display='block';document.getElementById('ulPreviewImg-'+bid).src=URL.createObjectURL(f);document.getElementById('ulCartBtn-'+bid).disabled=false;document.getElementById('ulCartBtn-'+bid).textContent='Add to Cart'};
  window.removeUL3DFile=function(bid){ul3dData[bid].file=null;document.getElementById('ulUploadZone-'+bid).style.display='';document.getElementById('ulPreviewZone-'+bid).style.display='none';document.getElementById('ulFileInput-'+bid).value='';document.getElementById('ulCartBtn-'+bid).disabled=true;document.getElementById('ulCartBtn-'+bid).textContent='Upload design to continue'};
  window.selectUL3DSize=function(sel,bid){ul3dData[bid].size=sel.value;ul3dData[bid].price=parseFloat(sel.options[sel.selectedIndex].dataset.price)};
  window.changeUL3DQty=function(bid,d){var i=document.getElementById('ulQtyInput-'+bid),v=parseInt(i.value)+d;if(v<1)v=1;i.value=v};
  window.addUL3DToCart=function(bid){var btn=document.getElementById('ulCartBtn-'+bid),qty=parseInt(document.getElementById('ulQtyInput-'+bid).value)||1;btn.disabled=true;btn.textContent='Adding...';fetch('/cart/add.js',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({items:[{id:ul3dData[bid].vid,quantity:qty,properties:{'_upload_file':ul3dData[bid].file?.name||'','_sheet_size':ul3dData[bid].size,'_unit_price':'$'+ul3dData[bid].price}}]})}).then(function(r){return r.json()}).then(function(){btn.textContent='âœ“ Added!';setTimeout(function(){closeUL3DModal(bid);window.location.href='/cart'},800)}).catch(function(){btn.disabled=false;btn.textContent='Add to Cart'})};
  document.addEventListener('click',function(e){if(e.target.classList.contains('ul-modal-overlay'))closeUL3DModal(e.target.id.replace('ulModal-',''))});
})();
